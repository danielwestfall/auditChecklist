<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WCAG 2.2 Audit Report</title>
    <style>
      body {
        font-family: sans-serif;
      }

      header {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        display: flex; /* Use flexbox for the header */
        flex-wrap: wrap; /* Allow items to wrap */
        gap: 10px; /* Add some space between items */
        align-items: flex-end;
        font-weight: 600;
      }

      header > div {
        flex: 1; /* Allow input field divs to grow and take equal space */
      }

      /* Media query for smaller screens */
      @media (max-width: 600px) {
        /* Adjust the breakpoint as needed */
        header > div {
          flex-basis: 100%; /* Make input field divs take full width on smaller screens */
        }
      }

      main {
        display: flex; /* Enable flexbox for the main content area */
      }

      .sidebar {
        width: 250px; /* Adjust sidebar width as needed */
        padding: 10px;
        border-right: 1px solid #ddd; /* Add a separator */
      }

      .controls {
        display: flex;
        flex-direction: column;
        max-height: 100vh; /* Limit the height to the viewport height */
        overflow-y: auto; /* Add vertical scroll if content exceeds height */
      }

      .main-content {
        flex: 1; /* Allow main content to take up remaining space */
        padding: 10px;
      }

      .tab-content {
        display: none;
        border: 1px solid #ddd;
        padding: 10px;
      }

      .tab-content.active {
        display: block;
      }

      input[type="radio"] {
        margin-right: 5px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      iframe {
        width: 80vw;
        height: 80vh;
        border: none;
      }

      .guideline-control {
        display: flex;
        align-items: center; /* Center vertically */
        justify-content: center; /* Center horizontally */
        margin-bottom: 10px;
        flex-direction: column;
      }

      .guideline-control label {
        margin-right: 10px;
      }

      .guideline-control > div {
        padding-top: 5px;
        padding-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <header>
      <div>
        <h1>WCAG 2.2 Checklist</h1>
      </div>
      <div>
        <label for="page-name">Page Name:</label>
        <input type="text" id="page-name" />
      </div>
      <div>
        <label for="page-address">Page Address:</label>
        <input type="text" id="page-address" />
      </div>
      <div>
        <label for="audit-date">Audit Date:</label>
        <input type="date" id="audit-date" value="" />
      </div>
    </header>
    <main>
      <div class="sidebar">
        <div class="controls">
          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-1.1" name="guideline" checked />
              <label for="guideline-1.1">1.1 Text Alternatives</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-1.1-completed" />
              <label for="guideline-1.1-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-1.2" name="guideline" />
              <label for="guideline-1.2">1.2 Time-based Media</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-1.2-completed" />
              <label for="guideline-1.2-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-1.3" name="guideline" />
              <label for="guideline-1.3">1.3 Adaptable</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-1.3-completed" />
              <label for="guideline-1.3-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-1.4" name="guideline" />
              <label for="guideline-1.4">1.4 Distinguishable</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-1.4-completed" />
              <label for="guideline-1.4-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-2.1" name="guideline" />
              <label for="guideline-2.1">2.1 Keyboard Accessible</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-2.1-completed" />
              <label for="guideline-2.1-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-2.2" name="guideline" />
              <label for="guideline-2.2">2.2 Enough Time</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-2.2-completed" />
              <label for="guideline-2.2-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-2.3" name="guideline" />
              <label for="guideline-2.3">2.3 Seizures</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-2.3-completed" />
              <label for="guideline-2.3-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-2.4" name="guideline" />
              <label for="guideline-2.4">2.4 Navigable</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-2.4-completed" />
              <label for="guideline-2.4-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-2.5" name="guideline" />
              <label for="guideline-2.5">2.5 Input Modalities</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-2.5-completed" />
              <label for="guideline-2.5-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-3.1" name="guideline" />
              <label for="guideline-3.1">3.1 Readable</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-3.1-completed" />
              <label for="guideline-3.1-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-3.2" name="guideline" />
              <label for="guideline-3.2">3.2 Predictable</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-3.2-completed" />
              <label for="guideline-3.2-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-3.3" name="guideline" />
              <label for="guideline-3.3">3.3 Input Assistance</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-3.3-completed" />
              <label for="guideline-3.3-completed">Completed</label>
            </div>
          </div>

          <div class="guideline-control">
            <div>
              <input type="radio" id="guideline-4.1" name="guideline" />
              <label for="guideline-4.1">4.1 Compatible</label>
            </div>
            <div>
              <input type="checkbox" id="guideline-4.1-completed" />
              <label for="guideline-4.1-completed">Completed</label>
            </div>
          </div>

          <button onclick="generateReport()">Generate Report</button>
        </div>
      </div>
      <div id="guideline-1.1-content" class="tab-content active">
        <iframe
          id="guideline-1.1-iframe"
          src="1_1_Text_Alternatives.html"
        ></iframe>
      </div>
      <div id="guideline-1.2-content" class="tab-content">
        <iframe
          id="guideline-1.2-iframe"
          src="1_2_Time-based_Media.html"
        ></iframe>
      </div>
      <div id="guideline-1.3-content" class="tab-content">
        <iframe id="guideline-1.3-iframe" src="1_3_Adaptable.html"></iframe>
      </div>
      <div id="guideline-1.4-content" class="tab-content">
        <iframe
          id="guideline-1.4-iframe"
          src="1_4_Distinguishable.html"
        ></iframe>
      </div>
      <div id="guideline-2.1-content" class="tab-content">
        <iframe
          id="guideline-2.1-iframe"
          src="2_1_Keyboard_Accessible.html"
        ></iframe>
      </div>
      <div id="guideline-2.2-content" class="tab-content">
        <iframe id="guideline-2.2-iframe" src="2_2_Enough_Time.html"></iframe>
      </div>
      <div id="guideline-2.3-content" class="tab-content">
        <iframe id="guideline-2.3-iframe" src="2_3_Seizures.html"></iframe>
      </div>
      <div id="guideline-2.4-content" class="tab-content">
        <iframe id="guideline-2.4-iframe" src="2_4_Navigable.html"></iframe>
      </div>
      <div id="guideline-2.5-content" class="tab-content">
        <iframe
          id="guideline-2.5-iframe"
          src="2_5_Input_Modalities.html"
        ></iframe>
      </div>
      <div id="guideline-3.1-content" class="tab-content">
        <iframe id="guideline-3.1-iframe" src="3_1_Readable.html"></iframe>
      </div>
      <div id="guideline-3.2-content" class="tab-content">
        <iframe id="guideline-3.2-iframe" src="3_2_Predictable.html"></iframe>
      </div>
      <div id="guideline-3.3-content" class="tab-content">
        <iframe
          id="guideline-3.3-iframe"
          src="3_3_Input_Assistance.html"
        ></iframe>
      </div>
      <div id="guideline-4.1-content" class="tab-content">
        <iframe id="guideline-4.1-iframe" src="4_1_Compatible.html"></iframe>
      </div>
    </main>

    <button onclick="downloadTable()">Download Generated Table</button>
    <table id="report-table"></table>

    <script>
      const inputFields = document.querySelectorAll("input, textarea");

      // Save data to sessionStorage on input change
      inputFields.forEach((input) => {
        input.addEventListener("input", () => {
          sessionStorage.setItem(input.id, input.value);
        });
      });

      // Load data from sessionStorage on page load
      window.addEventListener("load", () => {
        inputFields.forEach((input) => {
          const savedValue = sessionStorage.getItem(input.id);
          if (savedValue) {
            input.value = savedValue;
          }
        });
      });

      // Function to show the selected tab
      function showTab(tabId) {
        const tabContents = document.querySelectorAll(".tab-content");
        tabContents.forEach((tab) => tab.classList.remove("active"));
        document.getElementById(tabId + "-content").classList.add("active");
      }

      // Event listeners for radio button changes
      const radioButtons = document.querySelectorAll('input[name="guideline"]');
      radioButtons.forEach((radio) => {
        radio.addEventListener("change", () => {
          showTab(radio.id);
        });
      });

      function generateReport() {
        const table = document.getElementById("report-table");
        const pageName = document.getElementById("page-name").value;
        const pageAddress = document.getElementById("page-address").value;
        const auditDate = document.getElementById("audit-date").value;
        table.innerHTML = ""; // Clear previous table data

        const firstRow = table.insertRow();
        firstRow.insertCell().textContent = "Page Name:";
        firstRow.insertCell().textContent = pageName;
        firstRow.insertCell().textContent = "Page Address:";
        firstRow.insertCell().textContent = pageAddress;
        firstRow.insertCell().textContent = auditDate;

        // Add table header (after the input field row)
        const headerRow = table.insertRow();
        headerRow.insertCell().textContent = "Guideline";
        headerRow.insertCell().textContent = "Success Criterion";
        headerRow.insertCell().textContent = "Notes";
        headerRow.insertCell().textContent = "Completed";
        headerRow.insertCell().textContent = "Applicable";

        // Function to process each guideline
        function processGuideline(guidelineId, guidelineName) {
          const iframe = document.getElementById(guidelineId + "-iframe");
          const completed = document.getElementById(
            guidelineId + "-completed"
          ).checked;
          const checklistData = JSON.parse(
            iframe.contentWindow.getChecklistData()
          );

          for (const sc in checklistData) {
            const row = table.insertRow();
            row.insertCell().textContent = guidelineName;
            row.insertCell().textContent = sc;
            row.insertCell().textContent = checklistData[sc].notes; // Access notes from the object
            row.insertCell().textContent = completed ? "Yes" : "No";
            row.insertCell().textContent = checklistData[sc].applicable
              ? "Yes"
              : "N/A"; // Add "Applicable" status
          }
        }

        // Process each guideline
        processGuideline("guideline-1.1", "1.1 Text Alternatives");
        processGuideline("guideline-1.2", "1.2 Time-based Media");
        processGuideline("guideline-1.3", "1.3 Adaptable");
        processGuideline("guideline-1.4", "1.4 Distinguishable");
        processGuideline("guideline-2.1", "2.1 Keyboard Accessible");
        processGuideline("guideline-2.2", "2.2 Enough Time");
        processGuideline("guideline-2.3", "2.3 Seizures");
        processGuideline("guideline-2.4", "2.4 Navigable");
        processGuideline("guideline-2.5", "2.5 Input Modalities");
        processGuideline("guideline-3.1", "3.1 Readable");
        processGuideline("guideline-3.2", "3.2 Predictable");
        processGuideline("guideline-3.3", "3.3 Input Assistance");
        processGuideline("guideline-4.1", "4.1 Compatible");
      }

      function downloadTable() {
        const table = document.getElementById("report-table");
        const pageName = document.getElementById("page-name").value;
        const pageAddress = document.getElementById("page-address").value;
        const auditDate = document.getElementById("audit-date").value;
        let csvContent = "data:text/csv;charset=utf-8,"; // Add this line

        // Add input field values to separate rows in CSV
        csvContent += '"Page Name:","' + pageName + '","","",""\r\n';
        csvContent += '"Page Address:","' + pageAddress + '","","",""\r\n';
        csvContent += '"Audit Date:","' + auditDate + '","","",""\r\n';

        // Add regular header
        csvContent +=
          '"Guideline","Success Criterion","Notes","Completed","Applicable"\r\n';

        // Loop through original table rows (excluding the input field rows)
        const rows = table.querySelectorAll("tr");
        for (let i = 3; i < rows.length; i++) {
          // Start from index 3 to skip the input field rows
          const row = rows[i];
          const rowData = [];
          const cells = row.querySelectorAll("th, td");

          cells.forEach(function (cell) {
            let cellData = cell.textContent.replace(/,/g, "");
            cellData = '"' + cellData + '"';
            rowData.push(cellData);
          });

          csvContent += rowData.join(",") + "\r\n";
        }

        // Create download link
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "wcag_audit_report.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      const today = new Date().toISOString().split("T")[0]; // Get today's date in YYYY-MM-DD format
      document.getElementById("audit-date").value = today;
    </script>
  </body>
</html>
